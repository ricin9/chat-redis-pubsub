<div class="flex h-[calc(100vh-8rem)]">
  <!-- Rooms list -->
  <div class="w-1/4 bg-white rounded shadow p-4">
    <h2 class="text-xl font-bold mb-4">Rooms</h2>
    <ul id="room-list">
      {{range .Rooms}}
      <li class="mb-2">
        <button
          hx-get="/rooms/{{.ID}}"
          hx-target="#room-messages"
          hx-push-url="true"
          class="text-blue-600 hover:underline"
        >
          {{.Name}}
        </button>
      </li>
      {{end}}
    </ul>
  </div>

  <!-- Messages -->
  <div
    id="room-messages"
    class="w-3/4 ml-4 flex flex-col bg-white rounded shadow p-4"
  >
    <h3 id="messages" class="text-2xl">
      Welcome, Select a chat room on the left to view its messages.
    </h3>
  </div>
</div>

<script>
  document.addEventListener("htmx:afterSettle", function (event) {
    const messages = document.getElementById("messages");
    if (messages) {
      messages.scrollTo(0, messages.scrollHeight);
    }
  });

  document.addEventListener("htmx:wsAfterMessage", function (event) {
    const messages = document.getElementById("messages");
    if (messages) {
      // Check if user is near the bottom
      const isAtBottom =
        messages.scrollHeight - messages.scrollTop <=
        messages.clientHeight + 50;

      if (isAtBottom) {
        messages.scrollTo(0, messages.scrollHeight);
      }
      // TODO, show notification if user is not at the bottom
    }
  });
</script>
